define("ui/slide",["jquery","mod/emitter"],function($,Emitter){function transitionEnd(){var el=document.createElement("div"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(void 0!==el.style[name])return transEndEventNames[name]}function getVendorPropertyName(prop){var el=document.createElement("div");if(prop in el.style)return prop;for(var prefixes=["Moz","Webkit","O","ms"],prop_=prop.charAt(0).toUpperCase()+prop.substr(1),i=0;i<prefixes.length;++i){var vendorProp=prefixes[i]+prop_;if(vendorProp in el.style)return vendorProp}}function emulateTransitionEnd(el,duration){var called=!1;el.one(transitionEndEventName,function(){called=!0});var callback=function(){called||el.trigger(transitionEndEventName)};setTimeout(callback,duration)}function Slide(screen,options){this.options=$.extend({},defaultOptions,options),this.init(screen)}var detector={transition:getVendorPropertyName("transition"),transitionDuration:getVendorPropertyName("transitionDuration"),transitionEnd:transitionEnd(),transform:getVendorPropertyName("transform"),hasTouch:function(){var win=window,doc=document;return!!("ontouchstart"in win||win.DocumentTouch&&doc instanceof DocumentTouch)}()};if(detector.transition&&detector.transform)var transformProp=(detector.transition,detector.transform),transitionEndEventName=detector.transitionEnd,transitionDurationProp=detector.transitionDuration,useTransform=!0;var defaultOptions={duration:500,prevBtn:"",nextBtn:"",nav:"",pause:$.noop,onTurnTo:$.noop,play:!1,interval:3e3,autoplay:!1,loop:!1};return $.extend(Slide.prototype,{init:function(screen){if(this.screen=screen,this.slideList=this.screen.find(".slide-list"),this.slides=this.slideList.find(".slide-item"),this.slideCount=this.slides.length,this.screenWidth=this.slideList.width(),this.slideList.length&&this.slides.length){if(this.nav=this.options.nav,this.nextBtn=this.options.nextBtn,this.prevBtn=this.options.prevBtn,this.autoplay=this.options.autoplay,this.loop=this.options.loop,this.body=$("body"),detector.hasTouch&&this.screen.css({"user-select":"none","touch-action":"none","touch-callout":"none","content-zooming":"none","user-drag":"none","tap-highlight-color":"rgba(0,0,0,0)"}),this.loop){var node={};$(["first","last"]).each($.proxy(function(index,name){node[name]=this.slides[name]().clone().addClass("clone")},this)),this.slideList.append(node.first).prepend(node.last),this.slideList.css({width:this.screenWidth*(this.slideCount+2)}),this.index=1,this.move(this.index)}else this.slideList.css({width:this.screenWidth*this.slideCount}),this.index=0,this.move(this.index),this.changeBtnStatus(this.index);this.nav&&(this.controls=this.nav.find("[data-index]"),this.controlIndex=1,this.controls.eq(0).addClass("active")),this.listen(),this.delay=this.options.interval+this.options.duration,this.autoplay&&this.play()}},listenTouch:function(){var release=$.proxy(function(e){if(this.dragstarted){this.dragstarted=!1;var eventData=e.originalEvent&&e.originalEvent.data||e.data;if(eventData){var deltaX=eventData.deltaX,absDeltaX=Math.abs(deltaX);absDeltaX>this.screenWidth&&(deltaX=(deltaX>0?1:-1)*this.screenWidth),absDeltaX>this.screenWidth/5?this.slide(0>deltaX?"next":"prev"):this.turnTo(this.index)}}},this);this.screen.on("touch",$.proxy(function(){this.dragstarted=!1,this.pause(),this.body.one("release",release)},this)),this.screen.on("drag",$.proxy(function(e){var eventData=e.originalEvent&&e.originalEvent.data||e.data;if(eventData){var deltaX=eventData.deltaX,direction=eventData.direction,srcEvent=eventData.srcEvent;("left"===direction||"right"===direction)&&(srcEvent.preventDefault(),this.dragstarted=!0,deltaX&&this.move(this.index,deltaX))}},this))},listen:function(){var self=this;this.nav&&this.controls.click(function(e){var el=$(e.currentTarget),thenIndex=el.data("index");thenIndex!==self.slidingIndex&&(self.slidingIndex=thenIndex,self.pause(),self.turnTo(thenIndex))}),this.prevBtn&&this.prevBtn.click(function(e){e.preventDefault(),$(this).hasClass("disabled")||self.prev()}),this.nextBtn&&this.nextBtn.click(function(e){e.preventDefault(),$(this).hasClass("disabled")||self.next()}),detector.hasTouch&&this.listenTouch(),this.autoplay&&this.screen.on("mouseenter",$.proxy(this.pause,this)).on("mouseleave",$.proxy(this.play,this))},turnTo:function(index,rawIndex){this.trigger("turn",rawIndex||index);var onAnimate=$.proxy(function(){this.autoplay&&this.play(),rawIndex&&(index=this.move(rawIndex)),this.turnEnd(index)},this);this.moveControl(rawIndex||index),this.slidingIndex=rawIndex||index;var targetLeft=-index*this.screenWidth,duration=this.options.duration;this.translate(targetLeft,duration,onAnimate)},moveControl:function(index){if(this.controlIndex!==index&&this.nav){var old=this.nav.find(".active"),current=this.controls.eq(index-1);old.removeClass("active"),current.addClass("active"),this.controlIndex=index}},turnEnd:function(index){this.index=index,this.slidingIndex=null,this.options.onTurnTo&&this.options.onTurnTo.apply(this,arguments)},play:function(){return this.delay&&!this.interval?(this.interval=setInterval($.proxy(this.next,this),this.delay),this):void 0},pause:function(){return this.delay?(this.slidingIndex&&useTransform&&this.slideList.trigger(transitionEndEventName),this.interval=clearInterval(this.interval),this):void 0},move:function(pos,deltaX){var left=-pos*this.screenWidth+(deltaX||0);return this.translate(left,0),pos},translate:function(){var translateMethod;translateMethod=useTransform?this.translateByTransform:this.translateByAbsLeft,translateMethod.apply(this,arguments)},translateByAbsLeft:function(left,duration,callback){return duration?(this.slideList.stop().animate({left:left},duration,callback),void 0):this.slideList.css({left:left})},translateByTransform:function(left,duration,callback){var style=this.slideList[0].style;style[transformProp]="translate("+left+"px,0) "+"translateZ(0)",style[transitionDurationProp]=duration+"ms",duration&&(this.slideList.one(transitionEndEventName,$.proxy(function(){callback()},this)),emulateTransitionEnd(this.slideList,duration))},slide:function(direct){if(!this.slidingIndex){var isLimit,isNext="next"===direct,offsetIndex=isNext?1:-1,thenIndex=this.index+offsetIndex,rawIndex=thenIndex;this.loop?(isLimit=isNext?thenIndex>this.slideCount:0>=thenIndex,isLimit?(rawIndex=isNext?1:this.slideCount,this.turnTo(thenIndex,rawIndex)):this.turnTo(thenIndex)):(isLimit=isNext?thenIndex>this.slideCount-1:0>thenIndex,isLimit&&(thenIndex=isNext?this.slideCount-1:0),this.changeBtnStatus(thenIndex),this.turnTo(thenIndex))}},next:function(){this.slidingIndex||this.pause().slide("next")},prev:function(){this.slidingIndex||this.pause().slide("prev")},changeBtnStatus:function(thenIndex){thenIndex=thenIndex||0,this.prevBtn[0===thenIndex?"addClass":"removeClass"]("disabled"),this.nextBtn[thenIndex===this.slideCount-1?"addClass":"removeClass"]("disabled")}}),Emitter(Slide.prototype),Slide});