Do("widget/login-and-signup",function(){function getEbookUrl(el){return window.location.origin+"/ebook/"+el.attr("aid")+"/"}function writeReferUrl(el){var action=el.data("login-action"),url=window.location.href;action&&(url=referUrlTypes[action],url=$.isFunction(url)?url(el):url);var searchSplits=url.split("?"),hashSplits=url.split("#"),hash=hashSplits[1],searchAndHash=searchSplits[1],search=searchAndHash&&searchAndHash.split("#")[0],path=search&&searchSplits[0]||hashSplits[0];search&&(search=search.replace(/[&]?(dcs|dcm)=[^&]*/g,"")),search=(search?search+"&":"")+"dcs=login&dcm=anonymous",url=path+"?"+search+(hash?"#"+hash:""),document.cookie="refer_url="+url+";domain="+"douban.com"+";path="+"/"}window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host);var referUrlTypes={present:function(el){return getEbookUrl(el)+"present"},purchase:function(el){return getEbookUrl(el)+"#purchase"},sample:function(el){return getEbookUrl(el)+"#sample"},kindle:function(){return window.location.origin+"/kindle/apply"}};$(".login, .signup, .require-login").click(function(e){e.preventDefault();var el=$(this),type=el.data("target-dialog");return Ark.ga.trackEvent("anonymous","loginDialogue"),writeReferUrl(el),new Ark.loginAndSignup({type:type,context:"store"})})});