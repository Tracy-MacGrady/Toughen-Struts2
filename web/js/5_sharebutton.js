(function(){function f(g,h){for(p in h){if(h.hasOwnProperty(p)){g[p]=h[p]}}return g}function b(g){return Object.prototype.toString.call(g)==="[object Array]"}function e(h){if(document.getElementById("css-share-button")){return}var g=document.createElement("style");g.type="text/css";g.id="css-share-button";if(g.styleSheet){g.styleSheet.cssText=h}else{g.appendChild(document.createTextNode(h))}try{document.getElementsByTagName("head")[0].appendChild(g)}catch(i){}}var c=".bn-sharing{padding-right:10px;background-image: url(1_a1.png) !important; background-repeat: no-repeat !important; background-position: 100% -19px !important;*display:inline-block;}a.bn-sharing:hover{text-decoration:underline;} .bn-sharing-on{background-position:100% 4px !important;position:relative !important;z-index:1 !important;}#db-div-sharing{position:absolute;width:100px;*margin-top:-2px;}#db-div-sharing .bd{border:1px solid #aaa;background:#fff;padding:10px 0 0 10px;}#db-div-sharing .bd li{line-height:17px;margin-bottom:10px;}#db-div-sharing .hd{position:absolute;height:24px;*line-height:21px;overflow:hidden;right:0;top:-24px;padding:0 5px;border:1px solid #aaa;border-bottom:none;background:#fff;}.rec-ren,.rec-sin,.rec-kx,.rec-msn,.rec-qzone,.rec-tx,.rec-sohu,.rec-qqim{padding-left:20px;background:url(2_a4.png) no-repeat 0 0;}.rec-ren{background-position:0 -90px;}.rec-sin{background-position:0 -30px;}.rec-msn{background-position:0 -60px;}.rec-kx{background-position:0 -120px;}.rec-tx{background-position:0 -150px;}.rec-sohu{background-position:0 -180px;}.rec-qqim{background-position:0 -243px;}";var d={sina:"3015934887",tx:"1459b2ac3d2345d2a17396eec5ad3bd7"};var a={default_menu_list:["sina","renren","qzone","tx","sohu","kx","qqim","msn"],services:{sina:{label:"新浪微博",class_name:"rec-sin",log_vendor:"bshare_sina",popup:{width:440,height:430},url:"http://v.t.sina.com.cn/share/share.php?appkey="+d.sina+"&url={{url}}&title={{title}}&pic={{image_url}}&source=&sourceUrl=&content=utf-8"},renren:{label:"人人网",class_name:"rec-ren",log_vendor:"bshare_renren",popup:{width:550,height:400},url:"http://www.connect.renren.com/share/sharer?url={{url}}"},kx:{label:"开心网",class_name:"rec-kx",log_vendor:"bshare_kx",url:"http://www.kaixin001.com/repaste/bshare.php?rtitle={{title}}&rcontent=&rurl={{url}}"},sohu:{label:"搜狐微博",class_name:"rec-sohu",log_vendor:"bshare_sohu",popup:{width:660,height:470},url:"css\3_post.jsp?url={{url}}&title={{title}}&pic={{image_url}}&content=utf-8"},qzone:{label:"QQ空间",class_name:"rec-qzone",log_vendor:"bshare_qzone",url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={{url}}"},tx:{label:"腾讯微博",class_name:"rec-tx",log_vendor:"bshare_tx",popup:{width:700,height:680},url:"http://v.t.qq.com/share/share.php?appkey="+d.tx+"&url={{url}}&title={{title}}&pic={{image_url}}"},qqim:{label:"QQ好友",class_name:"rec-qqim",log_vendor:"bshare_qqim",url:"http://connect.qq.com/widget/shareqq/index.html?url={{url}}&desc={{title}}&pics={{image_url}}&site=豆瓣"},msn:{label:"MSN",class_name:"rec-msn",log_vendor:"bshare_msn",url:"http://profile.live.com/badge?url={{url}}&title={{title}}&wa=wsignin1.0"}},renderUrl:function(g,m){var j=g.url,l=encodeURIComponent;j=j.replace("{{url}}",l(m.url)).replace("{{title}}",l(m.title)).replace("{{image_url}}",l(m.image_url)).replace(/'/g,"%27");if(g.log_vendor){j="http://www.douban.com/link2?type=redir&vendor="+g.log_vendor+"&url="+l(j)}if(g.popup){var i=g.popup.width,k=g.popup.height;j='javascript:void((function(s,d){var%20f="'+l(j)+'";function%20a(){if(!window.open(f,"mb",["toolbar=0,status=0,resizable=1,width='+i+",height="+k+',left=",(s.width-'+i+')/2,",top=",(s.height-'+k+')/2].join("")))location.href=f};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a()})(screen, document))'}return j},getMenuListHTML:function(g,n,k){var r,l,s=[],h,o=this.menu_list;var m={url:g||"",title:n||"",image_url:k||""};for(var j=0;j<o.length;j++){r=o[j];l=this.services[r];if(!l){continue}h='<li class="'+(l.class_name||"")+'">';h+="<a "+(l.popup?"":'target="_blank"')+" href='"+this.renderUrl(l,m)+"'>"+l.label+"</a>";h+="</li>";s.push(h)}var q='<div class="hd">&nbsp;</div><div class="bd"><ul>'+s.join("")+"</ul></div>";return q},getShareContent:function(h){var i={url:location.href,title:document.title};var g;if(this.source_type=="Topic"){g=$(".topic-figure img")}else{g=$("#mainpic img")}i.image_url=g.length?g[0].src:"";this.share_content=f(i,h||{})},hackForTopicWeibo:function(){if(this.source_type=="Topic"){this.services.sina.url=this.services.sina.url.replace(d.sina,"3368957101");this.services.sina.url+="&ralateUid=3083247701"}},hideMenu:function(){$(".bn-sharing-on").removeClass("bn-sharing-on");$("#db-div-sharing").hide()},bindEvents:function(){var g=this;$(document.body).click(function(k){var i=$(k.target);if(!i.hasClass("bn-sharing")||i.hasClass("bn-sharing-on")){g.hideMenu();return}k.preventDefault();k.stopPropagation();i.addClass("bn-sharing-on");var q=$("#db-div-sharing");if(!q.length){q=$('<div id="db-div-sharing"></div>').appendTo("body")}var n,h,j;if(i.hasClass("in-list")){var o=i.closest(".ctsh").find("h3 a:eq(0)");n=i.data("title")||(o.length?o.text():g.share_content.title)}else{n=i.data("title")||g.share_content.title}var l=i.data("type");if(l){g.source_type=l;g.hackForTopicWeibo()}h=i.data("url")||g.share_content.url;j=i.data("pic")||g.share_content.image_url;q.html(g.getMenuListHTML(h,n,j));var m=i.offset();q.find(".hd").css("width",i[0].offsetWidth+"px");q.css("top",(m.top+24-4)+"px").css("left",(m.left-q.width()+i.width()+16)+"px");q.find(".hd a").addClass("bn-sharing-on");q.show()});window.onresize=g.hideMenu},init:function(g){var g=g||{};if(b(g)){if(g.length===0){g={}}else{g={menu_list:g}}}this.menu_list=g.menu_list||this.default_menu_list;f(this.services,g.custom_services||{});this.source_type=g.source_type||"douban";this.hackForTopicWeibo();e(c);this.getShareContent(g.share_content);this.bindEvents()}};window.ShareButton=a})();window.ShareButton.init(window.DoubanShareMenuList);